{% extends "base.html" %}
{% block content %}
<div class="container-fluid bg-light min-vh-100 py-5">
  <div class="container" style="max-width: 1800px;">

    <!-- Tarjetas principales -->
    <div class="row g-4 mb-4">
    <div class="col-12 col-md-3">
        <div class="card metric-card main-card text-center">
        <div class="card-body d-flex flex-column justify-content-center">
            <h4 class="mb-3">CDMX</h4>
            <h1 class="display-4 big-number">{{ current_temp }}°C</h1>
            <p class="text-muted">{{ now().strftime('%d/%m/%Y') if false else "" }}</p>
        </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card metric-card text-center">
        <div class="card-body d-flex flex-column justify-content-center">
            <h6 class="label-title">Promedio</h6>
            <h2 class="big-number">{{ temp_mean }}°C</h2>
        </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card metric-card text-center">
        <div class="card-body d-flex flex-column justify-content-center">
            <h6 class="label-title">Mínima</h6>
            <h2 class="big-number">{{ temp_min }}°C</h2>
        </div>
        </div>
    </div>

    <div class="col-12 col-md-3">
        <div class="card metric-card text-center">
        <div class="card-body d-flex flex-column justify-content-center">
            <h6 class="label-title">Máxima</h6>
            <h2 class="big-number">{{ temp_max }}°C</h2>
        </div>
        </div>
    </div>
    </div>


    <!-- Próximas horas -->
<!-- Pronóstico por horas -->
<!-- Forecast Card Mejorada con Scroll -->
  <div class="card shadow-sm mb-4 border-0 custom-forecast-card">
    <div class="card-body px-4 py-3 overflow-auto forecast-scroll">
      <div class="d-flex flex-nowrap justify-content-start align-items-center">
        {% for row in forecast %}
          <div class="text-center px-4 py-2 forecast-item flex-shrink-0">
            <div class="forecast-hour fw-bold fs-4">
              {{ 'Ahora' if loop.index0 == 0 else row.hour_label }}
            </div>
            <div style="font-size: 42px;">{{ row.icon }}</div>
            <div class="forecast-temp fw-semibold fs-5 mt-2">{{ row.temperature_2m }}°C</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>




<!-- Gráfica -->
<div class="card shadow-sm border-0 mt-4">
  <div class="card-body">
    <div style="height: 450px;">
      <canvas id="tempChart"></canvas>
    </div>
  </div>
</div>

<div id="chart-data" 
     data-labels='{{ hours | tojson }}'
     data-temps='{{ temps | tojson }}'>
</div>

<script>
  const ctx = document.getElementById('tempChart').getContext('2d');
  const el = document.getElementById("chart-data");
  const labels = JSON.parse(el.dataset.labels);
  const temps = JSON.parse(el.dataset.temps);

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: null,
        data: temps,
        fill: false, // ❌ no hay fondo
        borderColor: '#007bff', // ✔️ azul fuerte
        backgroundColor: '#007bff',
        tension: 0.4,
        pointRadius: 4,
        pointHoverRadius: 6,
        pointBackgroundColor: '#fff',
        pointBorderColor: '#007bff',
        pointBorderWidth: 2,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#333',
          titleFont: { size: 14 },
          bodyFont: { size: 13 },
          padding: 10,
          cornerRadius: 6,
        }
      },
      scales: {
        x: {
          title: {
            display: true,
            text: 'Horas',
            font: {
              size: 16,
              weight: 'bold'
            },
            color: '#444',
            padding: { top: 20 }
          },
          grid: {
            display: false
          },
          ticks: {
            color: '#444',
            font: { size: 14 }
          }
        },
        y: {
          title: {
            display: true,
            text: 'Temperatura (°C)',
            font: {
              size: 16,
              weight: 'bold'
            },
            color: '#444',
            padding: { bottom: 10 }
          },
          min: 8,
          max: 26,
          ticks: {
            stepSize: 2,
            color: '#444',
            font: { size: 14 },
            padding: 10
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)',
            lineWidth: 1
          }
        }
      }
    }
  });
</script>

{% endblock %}
